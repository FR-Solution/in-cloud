"use strict";(self.webpackChunkdocumentation=self.webpackChunkdocumentation||[]).push([[1740],{62774:(e,n,t)=>{t.d(n,{A:()=>g});var s=t(96540),r=t(34164),a=t(65627),l=t(56347),o=t(50372),u=t(30604),c=t(11861),i=t(78749);function d(e){return s.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,s.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function E(e){const{values:n,children:t}=e;return(0,s.useMemo)((()=>{const e=n??function(e){return d(e).map((e=>{let{props:{value:n,label:t,attributes:s,default:r}}=e;return{value:n,label:t,attributes:s,default:r}}))}(t);return function(e){const n=(0,c.XI)(e,((e,n)=>e.value===n.value));if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[n,t])}function _(e){let{value:n,tabValues:t}=e;return t.some((e=>e.value===n))}function h(e){let{queryString:n=!1,groupId:t}=e;const r=(0,l.W6)(),a=function(e){let{queryString:n=!1,groupId:t}=e;if("string"==typeof n)return n;if(!1===n)return null;if(!0===n&&!t)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return t??null}({queryString:n,groupId:t});return[(0,u.aZ)(a),(0,s.useCallback)((e=>{if(!a)return;const n=new URLSearchParams(r.location.search);n.set(a,e),r.replace({...r.location,search:n.toString()})}),[a,r])]}function b(e){const{defaultValue:n,queryString:t=!1,groupId:r}=e,a=E(e),[l,u]=(0,s.useState)((()=>function(e){let{defaultValue:n,tabValues:t}=e;if(0===t.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(n){if(!_({value:n,tabValues:t}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${n}" but none of its children has the corresponding value. Available values are: ${t.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return n}const s=t.find((e=>e.default))??t[0];if(!s)throw new Error("Unexpected error: 0 tabValues");return s.value}({defaultValue:n,tabValues:a}))),[c,d]=h({queryString:t,groupId:r}),[b,p]=function(e){let{groupId:n}=e;const t=function(e){return e?`docusaurus.tab.${e}`:null}(n),[r,a]=(0,i.Dv)(t);return[r,(0,s.useCallback)((e=>{t&&a.set(e)}),[t,a])]}({groupId:r}),T=(()=>{const e=c??b;return _({value:e,tabValues:a})?e:null})();(0,o.A)((()=>{T&&u(T)}),[T]);return{selectedValue:l,selectValue:(0,s.useCallback)((e=>{if(!_({value:e,tabValues:a}))throw new Error(`Can't select invalid tab value=${e}`);u(e),d(e),p(e)}),[d,p,a]),tabValues:a}}var p=t(9136);const T={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var f=t(74848);function m(e){let{className:n,block:t,selectedValue:s,selectValue:l,tabValues:o}=e;const u=[],{blockElementScrollPositionUntilNextRender:c}=(0,a.a_)(),i=e=>{const n=e.currentTarget,t=u.indexOf(n),r=o[t].value;r!==s&&(c(n),l(r))},d=e=>{let n=null;switch(e.key){case"Enter":i(e);break;case"ArrowRight":{const t=u.indexOf(e.currentTarget)+1;n=u[t]??u[0];break}case"ArrowLeft":{const t=u.indexOf(e.currentTarget)-1;n=u[t]??u[u.length-1];break}}n?.focus()};return(0,f.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,r.A)("tabs",{"tabs--block":t},n),children:o.map((e=>{let{value:n,label:t,attributes:a}=e;return(0,f.jsx)("li",{role:"tab",tabIndex:s===n?0:-1,"aria-selected":s===n,ref:e=>{u.push(e)},onKeyDown:d,onClick:i,...a,className:(0,r.A)("tabs__item",T.tabItem,a?.className,{"tabs__item--active":s===n}),children:t??n},n)}))})}function A(e){let{lazy:n,children:t,selectedValue:a}=e;const l=(Array.isArray(t)?t:[t]).filter(Boolean);if(n){const e=l.find((e=>e.props.value===a));return e?(0,s.cloneElement)(e,{className:(0,r.A)("margin-top--md",e.props.className)}):null}return(0,f.jsx)("div",{className:"margin-top--md",children:l.map(((e,n)=>(0,s.cloneElement)(e,{key:n,hidden:e.props.value!==a})))})}function C(e){const n=b(e);return(0,f.jsxs)("div",{className:(0,r.A)("tabs-container",T.tabList),children:[(0,f.jsx)(m,{...n,...e}),(0,f.jsx)(A,{...n,...e})]})}function g(e){const n=(0,p.A)();return(0,f.jsx)(C,{...e,children:d(e.children)},String(n))}},82257:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>i,contentTitle:()=>c,default:()=>_,frontMatter:()=>u,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"tech-docs/kubernetes/components/kubelet/appCerts","title":"appCerts","description":"\u0418\u043d\u0441\u0442\u0440\u0443\u043a\u0446\u0438\u044f \u0441\u043e\u0437\u0434\u0430\u043d\u0438\u044f \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u043e\u0432","source":"@site/docs/tech-docs/kubernetes/components/kubelet/appCerts.mdx","sourceDirName":"tech-docs/kubernetes/components/kubelet","slug":"/tech-docs/kubernetes/components/kubelet/appCerts","permalink":"/infrastructure/bcloud-docs/tech-docs/kubernetes/components/kubelet/appCerts","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{}}');var r=t(74848),a=t(28453),l=t(87464),o=t(62774);const u={},c=void 0,i={},d=[{value:"\u041a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u044f <code>openssl</code> kubelet-client",id:"\u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u044f-openssl-kubelet-client",level:4},{value:"\u041a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u044f <code>openssl</code> kubelet-server",id:"\u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u044f-openssl-kubelet-server",level:4},{value:"\u0413\u0435\u043d\u0435\u0440\u0430\u0446\u0438\u044f \u043f\u0440\u0438\u0432\u0430\u0442\u043d\u044b\u0445 \u043a\u043b\u044e\u0447\u0435\u0439 \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u043e\u0432",id:"\u0433\u0435\u043d\u0435\u0440\u0430\u0446\u0438\u044f-\u043f\u0440\u0438\u0432\u0430\u0442\u043d\u044b\u0445-\u043a\u043b\u044e\u0447\u0435\u0439-\u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u043e\u0432",level:4},{value:"\u0413\u0435\u043d\u0435\u0440\u0430\u0446\u0438\u044f CSR \u0431\u0443\u0434\u0443\u0449\u0438\u0445 \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u043e\u0432",id:"\u0433\u0435\u043d\u0435\u0440\u0430\u0446\u0438\u044f-csr-\u0431\u0443\u0434\u0443\u0449\u0438\u0445-\u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u043e\u0432",level:4},{value:"\u041f\u043e\u0434\u043f\u0438\u0441\u044c CSR \u043a\u043b\u044e\u0447\u043e\u043c \u0446\u0435\u043d\u0442\u0440\u0430 \u0430\u0443\u0442\u0435\u043d\u0442\u0438\u0444\u0438\u043a\u0430\u0446\u0438\u0438 (\u0426\u0410)",id:"\u043f\u043e\u0434\u043f\u0438\u0441\u044c-csr-\u043a\u043b\u044e\u0447\u043e\u043c-\u0446\u0435\u043d\u0442\u0440\u0430-\u0430\u0443\u0442\u0435\u043d\u0442\u0438\u0444\u0438\u043a\u0430\u0446\u0438\u0438-\u0446\u0430",level:4},{value:"\u0413\u0435\u043d\u0435\u0440\u0430\u0446\u0438\u044f Kubelet \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u043e\u0432",id:"\u0433\u0435\u043d\u0435\u0440\u0430\u0446\u0438\u044f-kubelet-\u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u043e\u0432",level:4}];function E(e){const n={admonition:"admonition",code:"code",h4:"h4",p:"p",pre:"pre",strong:"strong",...(0,a.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u0418\u043d\u0441\u0442\u0440\u0443\u043a\u0446\u0438\u044f \u0441\u043e\u0437\u0434\u0430\u043d\u0438\u044f \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u043e\u0432"})}),"\n",(0,r.jsxs)(o.A,{groupId:"install-type",children:[(0,r.jsxs)(l.A,{value:"HardWay",children:[(0,r.jsxs)(n.h4,{id:"\u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u044f-openssl-kubelet-client",children:["\u041a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u044f ",(0,r.jsx)(n.code,{children:"openssl"})," kubelet-client"]}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"cat <<EOF > ${KUBELET_CLIENT_CRT_CONF}\n[ req ]\ndefault_bits        = ${KUBELET_CLIENT_KEY_SIZE}\nprompt              = no\ndefault_md          = sha256\ndistinguished_name  = dn\n\n[ dn ]\nCN = system:node:${FULL_HOST_NAME}\nO  = system:nodes\n\n[ v3_ext ]\nauthorityKeyIdentifier=keyid,issuer:always\nbasicConstraints=CA:FALSE\nkeyUsage=keyEncipherment,dataEncipherment\nextendedKeyUsage=clientAuth\nEOF\n"})}),(0,r.jsxs)(n.h4,{id:"\u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u044f-openssl-kubelet-server",children:["\u041a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u044f ",(0,r.jsx)(n.code,{children:"openssl"})," kubelet-server"]}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'cat <<EOF > ${KUBELET_SERVER_CRT_CONF}\n[ req ]\ndefault_bits        = ${KUBELET_SERVER_KEY_SIZE}\nprompt              = no\ndefault_md          = sha256\ndistinguished_name  = dn\nreq_extensions      = req_ext\n\n[ req_ext ]\nsubjectAltName = @alt_names\n\n[ alt_names ]\nDNS.1 = localhost\nDNS.2 = ${HOST_NAME}\nDNS.3 = ${FULL_HOST_NAME}\nIP.1  = 127.0.0.1\nIP.2  = 0:0:0:0:0:0:0:1\nIP.3  = ${MACHINE_LOCAL_ADDRESS}\n\n[ dn ]\nCN = "system:node:${FULL_HOST_NAME}"\nO  = "system:nodes"\n\n[ v3_ext ]\nauthorityKeyIdentifier=keyid,issuer:always\nbasicConstraints=CA:FALSE\nkeyUsage=keyEncipherment,dataEncipherment\nextendedKeyUsage=serverAuth\nsubjectAltName=@alt_names\nEOF\n'})}),(0,r.jsx)(n.h4,{id:"\u0433\u0435\u043d\u0435\u0440\u0430\u0446\u0438\u044f-\u043f\u0440\u0438\u0432\u0430\u0442\u043d\u044b\u0445-\u043a\u043b\u044e\u0447\u0435\u0439-\u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u043e\u0432",children:"\u0413\u0435\u043d\u0435\u0440\u0430\u0446\u0438\u044f \u043f\u0440\u0438\u0432\u0430\u0442\u043d\u044b\u0445 \u043a\u043b\u044e\u0447\u0435\u0439 \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u043e\u0432"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'openssl genrsa \\\n  -out "${KUBELET_CLIENT_KEY_PATH}" ${KUBELET_CLIENT_KEY_SIZE}\nopenssl genrsa \\\n  -out "${KUBELET_SERVER_KEY_PATH}" ${KUBELET_SERVER_KEY_SIZE}\n'})}),(0,r.jsx)(n.h4,{id:"\u0433\u0435\u043d\u0435\u0440\u0430\u0446\u0438\u044f-csr-\u0431\u0443\u0434\u0443\u0449\u0438\u0445-\u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u043e\u0432",children:"\u0413\u0435\u043d\u0435\u0440\u0430\u0446\u0438\u044f CSR \u0431\u0443\u0434\u0443\u0449\u0438\u0445 \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u043e\u0432"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'openssl req \\\n  -new \\\n  -key "${KUBELET_CLIENT_KEY_PATH}" \\\n  -out "${KUBELET_CLIENT_CSR_PATH}" \\\n  -config "${KUBELET_CLIENT_CRT_CONF}"\n\nopenssl req \\\n  -new \\\n  -key "${KUBELET_SERVER_KEY_PATH}" \\\n  -out "${KUBELET_SERVER_CSR_PATH}" \\\n  -config "${KUBELET_SERVER_CRT_CONF}"\n'})}),(0,r.jsx)(n.h4,{id:"\u043f\u043e\u0434\u043f\u0438\u0441\u044c-csr-\u043a\u043b\u044e\u0447\u043e\u043c-\u0446\u0435\u043d\u0442\u0440\u0430-\u0430\u0443\u0442\u0435\u043d\u0442\u0438\u0444\u0438\u043a\u0430\u0446\u0438\u0438-\u0446\u0430",children:"\u041f\u043e\u0434\u043f\u0438\u0441\u044c CSR \u043a\u043b\u044e\u0447\u043e\u043c \u0446\u0435\u043d\u0442\u0440\u0430 \u0430\u0443\u0442\u0435\u043d\u0442\u0438\u0444\u0438\u043a\u0430\u0446\u0438\u0438 (\u0426\u0410)"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'openssl x509 \\\n  -req \\\n  -days 365 \\\n  -sha256 \\\n  -outform PEM \\\n  -CA "${KUBERNETES_CA_CRT_PATH}" \\\n  -CAkey "${KUBERNETES_CA_KEY_PATH}" \\\n  -CAcreateserial \\\n  -in "${KUBELET_CLIENT_CSR_PATH}" \\\n  -out "${KUBELET_CLIENT_CRT_PATH}" \\\n  -extensions v3_ext \\\n  -extfile "${KUBELET_CLIENT_CRT_CONF}"\n\nopenssl x509 \\\n  -req \\\n  -days 365 \\\n  -sha256 \\\n  -outform PEM \\\n  -CA "${KUBERNETES_CA_CRT_PATH}" \\\n  -CAkey "${KUBERNETES_CA_KEY_PATH}" \\\n  -CAcreateserial \\\n  -in "${KUBELET_SERVER_CSR_PATH}" \\\n  -out "${KUBELET_SERVER_CRT_PATH}" \\\n  -extensions v3_ext \\\n  -extfile "${KUBELET_SERVER_CRT_CONF}"\n\n'})}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'cat "${KUBELET_CLIENT_CRT_PATH}" "${KUBELET_CLIENT_KEY_PATH}" >> "${KUBELET_CURRENT_CLIENT_CRT_PATH}"\ncat "${KUBELET_SERVER_CRT_PATH}" "${KUBELET_SERVER_KEY_PATH}" >> "${KUBELET_CURRENT_SERVER_CRT_PATH}"\n'})}),(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u0418\u043d\u0441\u0442\u0440\u0443\u043a\u0446\u0438\u044f \u0441\u043e\u0437\u0434\u0430\u043d\u0438\u044f Kubeconfig"})}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'\nkubectl config set-cluster kubernetes \\\n  --certificate-authority="${KUBERNETES_CA_CRT_PATH}" \\\n  --embed-certs=true \\\n  --server=https://127.0.0.1:6443 \\\n  --kubeconfig=${BASE_K8S_PATH}/kubelet.conf\n\nkubectl config set-credentials system:node:${FULL_HOST_NAME} \\\n  --client-certificate=${KUBELET_CLIENT_CRT_PATH} \\\n  --client-key=${KUBELET_CLIENT_KEY_PATH} \\\n  --embed-certs=true \\\n  --kubeconfig=${BASE_K8S_PATH}/kubelet.conf\n\nkubectl config set-context default \\\n  --cluster=kubernetes \\\n  --user=system:node:${FULL_HOST_NAME} \\\n  --kubeconfig=${BASE_K8S_PATH}/kubelet.conf\n\nkubectl config use-context default --kubeconfig=${BASE_K8S_PATH}/kubelet.conf\n'})})]}),(0,r.jsxs)(l.A,{value:"Kubeadm",children:[(0,r.jsx)(n.h4,{id:"\u0433\u0435\u043d\u0435\u0440\u0430\u0446\u0438\u044f-kubelet-\u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u043e\u0432",children:"\u0413\u0435\u043d\u0435\u0440\u0430\u0446\u0438\u044f Kubelet \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u043e\u0432"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"kubeadm init phase kubeconfig kubelet \\\n    --config=${BASE_K8S_PATH}/kubeadm.conf\nkubeadm init phase kubelet-finalize experimental-cert-rotation \\\n    --config=${BASE_K8S_PATH}/kubeadm.conf\n"})}),(0,r.jsxs)(n.admonition,{type:"note",children:[(0,r.jsx)(n.p,{children:"\u041f\u043e\u0441\u043b\u0435 \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u044f \u043a\u043e\u043c\u0430\u043d\u0434 \u043c\u044b \u043f\u043e\u043b\u0443\u0447\u0430\u0435\u043c \u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0438\u0439 \u0432\u044b\u0432\u043e\u0434."}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'#### \u0413\u0435\u043d\u0435\u0440\u0430\u0446\u0438\u044f Kubelet \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u043e\u0432\n[kubeconfig] Writing "kubelet.conf" kubeconfig file\n'})})]})]})]})]})}function _(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(E,{...e})}):E(e)}},87464:(e,n,t)=>{t.d(n,{A:()=>l});t(96540);var s=t(34164);const r={tabItem:"tabItem_Ymn6"};var a=t(74848);function l(e){let{children:n,hidden:t,className:l}=e;return(0,a.jsx)("div",{role:"tabpanel",className:(0,s.A)(r.tabItem,l),hidden:t,children:n})}}}]);